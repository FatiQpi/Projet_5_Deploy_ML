name: CD - Deploy to HuggingFace


on:
  push:
    branches: [ "main", "test/fix-deploy" ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          lfs: true
      
      - name: Push to HF Hub
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: "Fatih09"
          SPACE_NAME: "Technova_api"
        run: |

          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          
          git lfs install
          git lfs track "data/*.joblib"
          git add .gitattributes

          git add --renormalize .
          git commit -m "Fix: Conversion LFS forcÃ©e" || true

          git remote remove hf 2>/dev/null || true
          git remote add hf https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_USERNAME/$SPACE_NAME
          
          git push --force hf main